<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AgentRegistry Contract - Opacus Protocol</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/docs/docs-style.css">
</head>
<body>
    <aside class="docs-sidebar">
        <div class="sidebar-logo">
            <img src="../logo.png" alt="Opacus">
        </div>
        
        <div class="sidebar-section">
            <h4>Getting Started</h4>
            <ul>
                <li><a href="index.html">Overview</a></li>
                <li><a href="getting-started.html">Quick Start</a></li>
                <li><a href="installation.html">Installation</a></li>
            </ul>
        </div>
        
        <div class="sidebar-section">
            <h4>Core Concepts</h4>
            <ul>
                <li><a href="architecture.html">Architecture</a></li>
                <li><a href="identity.html">Identity System</a></li>
                <li><a href="encryption.html">Encryption</a></li>
                <li><a href="verification.html">Verification</a></li>
            </ul>
        </div>
        
        <div class="sidebar-section">
            <h4>SDKs</h4>
            <ul>
                <li><a href="typescript.html">TypeScript SDK</a></li>
                <li><a href="rust.html">Rust SDK</a></li>
                <li><a href="examples.html">Code Examples</a></li>
            </ul>
        </div>
        
        <div class="sidebar-section">
            <h4>Smart Contracts</h4>
            <ul>
                <li><a href="contracts-overview.html">Overview</a></li>
                <li><a href="opacus-core.html">OpacusCore</a></li>
                <li><a href="dac-registry.html">DACRegistry</a></li>
                <li><a href="agent-registry.html" class="active">AgentRegistry</a></li>
                <li><a href="deployment.html">Deployment</a></li>
            </ul>
        </div>
        
        <div class="sidebar-section">
            <h4>Advanced</h4>
            <ul>
                <li><a href="security.html">Security Model</a></li>
                <li><a href="performance.html">Performance</a></li>
                <li><a href="troubleshooting.html">Troubleshooting</a></li>
            </ul>
        </div>
        
        <div class="sidebar-footer">
            <a href="https://github.com/Opacus-xyz/Opacus" target="_blank" rel="noopener">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
                </svg>
                <span>GitHub</span>
            </a>
        </div>
    </aside>
    
    <main class="docs-main">
        <div class="docs-header">
            <h1>AgentRegistry Contract</h1>
            <p>Manages agent identities, registration, and public key storage on 0G Chain.</p>
        </div>
        
        <div class="docs-content">
            <h2>Contract Overview</h2>
            
            <p><strong>AgentRegistry</strong> is responsible for:</p>
            
            <div class="feature-list">
                <div class="feature-item">
                    <span class="check">üÜî</span>
                    <span><strong>Agent Registration:</strong> Register new AI agents with unique identities</span>
                </div>
                <div class="feature-item">
                    <span class="check">üîë</span>
                    <span><strong>Key Management:</strong> Store Ed25519 and X25519 public keys</span>
                </div>
                <div class="feature-item">
                    <span class="check">üìù</span>
                    <span><strong>Metadata Storage:</strong> Store agent capabilities and information</span>
                </div>
                <div class="feature-item">
                    <span class="check">‚≠ê</span>
                    <span><strong>Reputation Tracking:</strong> Track agent reputation and attestation count</span>
                </div>
            </div>
            
            <div class="info-box">
                <h4>üìç Contract Address</h4>
                <p><code>0x9fE46736679d2D9a65F0992F2272dE9f3c7fa6e0</code></p>
                <p>Network: 0G Chain Testnet</p>
            </div>
            
            <h2>Agent Data Structure</h2>
            
            <pre><code>struct Agent {
    bytes32 id;                  // Unique agent ID
    address owner;               // Owner wallet address
    bytes32 edPublicKey;         // Ed25519 public key (signing)
    bytes32 xPublicKey;          // X25519 public key (encryption)
    string metadata;             // JSON metadata string
    bool active;                 // Is agent active
    uint256 reputation;          // Reputation score
    uint256 attestationCount;    // Number of attestations
    uint256 registeredAt;        // Registration timestamp
    uint256 lastActivity;        // Last activity timestamp
}</code></pre>
            
            <h2>Key Functions</h2>
            
            <h3>1. Register Agent</h3>
            <pre><code>function registerAgent(
    string calldata metadata,
    bytes32 edPublicKey,
    bytes32 xPublicKey
) external returns (bytes32 agentId)</code></pre>
            
            <p><strong>Description:</strong> Registers a new agent on the protocol.</p>
            
            <p><strong>Parameters:</strong></p>
            <ul>
                <li><code>metadata</code> - JSON string with agent info (name, version, capabilities)</li>
                <li><code>edPublicKey</code> - Ed25519 public key for signatures</li>
                <li><code>xPublicKey</code> - X25519 public key for encryption</li>
            </ul>
            
            <p><strong>Returns:</strong> Unique agent ID (keccak256 of public keys)</p>
            
            <p><strong>Gas Cost:</strong> ~100,000 gas (~0.0001 0G)</p>
            
            <p><strong>Example:</strong></p>
            <pre><code>const metadata = JSON.stringify({
  name: 'WeatherBot',
  version: '1.0.0',
  capabilities: ['weather-forecast', 'climate-data']
});

const tx = await agentRegistry.registerAgent(
  metadata,
  edPublicKeyBytes,
  xPublicKeyBytes
);

const receipt = await tx.wait();
const agentId = receipt.events[0].args.agentId;</code></pre>
            
            <h3>2. Get Agent</h3>
            <pre><code>function getAgent(
    bytes32 agentId
) external view returns (Agent memory)</code></pre>
            
            <p><strong>Description:</strong> Retrieves complete agent information.</p>
            
            <p><strong>Example:</strong></p>
            <pre><code>const agent = await agentRegistry.getAgent(agentId);

console.log('Agent:', {
  id: agent.id,
  owner: agent.owner,
  edPublicKey: agent.edPublicKey,
  xPublicKey: agent.xPublicKey,
  metadata: JSON.parse(agent.metadata),
  active: agent.active,
  reputation: agent.reputation.toNumber()
});</code></pre>
            
            <h3>3. Update Metadata</h3>
            <pre><code>function updateMetadata(
    bytes32 agentId,
    string calldata newMetadata
) external onlyAgentOwner(agentId)</code></pre>
            
            <p><strong>Description:</strong> Updates agent metadata.</p>
            
            <p><strong>Access:</strong> Only agent owner</p>
            
            <p><strong>Gas Cost:</strong> ~50,000 gas</p>
            
            <h3>4. Deactivate Agent</h3>
            <pre><code>function deactivateAgent(
    bytes32 agentId
) external onlyAgentOwner(agentId)</code></pre>
            
            <p><strong>Description:</strong> Deactivates an agent (can be reactivated later).</p>
            
            <h3>5. Reactivate Agent</h3>
            <pre><code>function reactivateAgent(
    bytes32 agentId
) external onlyAgentOwner(agentId)</code></pre>
            
            <p><strong>Description:</strong> Reactivates a previously deactivated agent.</p>
            
            <h3>6. Update Reputation</h3>
            <pre><code>function updateReputation(
    bytes32 agentId,
    int256 delta
) external onlyDACRegistry</code></pre>
            
            <p><strong>Description:</strong> Updates agent reputation score (called by DACRegistry).</p>
            
            <p><strong>Access:</strong> Only DACRegistry contract</p>
            
            <h3>7. Get Agents by Owner</h3>
            <pre><code>function getAgentsByOwner(
    address owner
) external view returns (bytes32[] memory)</code></pre>
            
            <p><strong>Description:</strong> Returns all agent IDs owned by an address.</p>
            
            <h3>8. Is Agent Active</h3>
            <pre><code>function isAgentActive(
    bytes32 agentId
) external view returns (bool)</code></pre>
            
            <p><strong>Description:</strong> Quick check if agent is active.</p>
            
            <h2>Events</h2>
            
            <pre><code>event AgentRegistered(
    bytes32 indexed agentId,
    address indexed owner,
    string metadata,
    uint256 timestamp
);

event AgentUpdated(
    bytes32 indexed agentId,
    string newMetadata
);

event AgentDeactivated(
    bytes32 indexed agentId
);

event AgentReactivated(
    bytes32 indexed agentId
);

event ReputationUpdated(
    bytes32 indexed agentId,
    int256 delta,
    uint256 newReputation
);</code></pre>
            
            <h2>Complete Usage Example</h2>
            
            <h3>TypeScript: Register and Manage Agent</h3>
            <pre><code>import { ethers } from 'ethers';
import { ed25519 } from '@noble/curves/ed25519';
import { x25519 } from '@noble/curves/ed25519';

// Setup
const provider = new ethers.JsonRpcProvider('https://evmrpc-testnet.0g.ai');
const wallet = new ethers.Wallet(PRIVATE_KEY, provider);
const agentRegistry = new ethers.Contract(
  AGENT_REGISTRY_ADDRESS,
  AGENT_REGISTRY_ABI,
  wallet
);

// Generate keypairs
const edPrivate = ed25519.utils.randomPrivateKey();
const edPublic = ed25519.getPublicKey(edPrivate);

const xPrivate = x25519.utils.randomPrivateKey();
const xPublic = x25519.getPublicKey(xPrivate);

// Prepare metadata
const metadata = JSON.stringify({
  name: 'MyAgent',
  version: '1.0.0',
  capabilities: ['chat', 'analysis'],
  description: 'AI assistant agent'
});

// Register agent
console.log('Registering agent...');
const tx = await agentRegistry.registerAgent(
  metadata,
  '0x' + Buffer.from(edPublic).toString('hex'),
  '0x' + Buffer.from(xPublic).toString('hex')
);

const receipt = await tx.wait();
const agentId = receipt.events[0].args.agentId;
console.log('‚úÖ Agent registered:', agentId);

// Fetch agent info
const agent = await agentRegistry.getAgent(agentId);
console.log('Agent details:', {
  id: agent.id,
  owner: agent.owner,
  active: agent.active,
  reputation: agent.reputation.toString()
});

// Update metadata
const updatedMetadata = JSON.stringify({
  name: 'MyAgent',
  version: '2.0.0',
  capabilities: ['chat', 'analysis', 'translation']
});

await agentRegistry.updateMetadata(agentId, updatedMetadata);
console.log('‚úÖ Metadata updated');</code></pre>
            
            <h3>Rust: Query Agent Information</h3>
            <pre><code>use ethers::prelude::*;

// Setup provider and contract
let provider = Provider::<Http>::try_from("https://evmrpc-testnet.0g.ai")?;
let agent_registry = AgentRegistry::new(AGENT_REGISTRY_ADDRESS, Arc::new(provider));

// Get agent
let agent = agent_registry.get_agent(agent_id).call().await?;

println!("Agent Info:");
println!("  ID: {:?}", agent.id);
println!("  Owner: {:?}", agent.owner);
println!("  Metadata: {}", agent.metadata);
println!("  Active: {}", agent.active);
println!("  Reputation: {}", agent.reputation);
println!("  Registered: {}", agent.registered_at);

// Check if active
let is_active = agent_registry.is_agent_active(agent_id).call().await?;
println!("Active status: {}", is_active);</code></pre>
            
            <h2>Querying Multiple Agents</h2>
            
            <pre><code>// Get all agents owned by an address
const ownerAddress = '0x...';
const agentIds = await agentRegistry.getAgentsByOwner(ownerAddress);

console.log(`Found ${agentIds.length} agents`);

// Fetch details for each
for (const id of agentIds) {
  const agent = await agentRegistry.getAgent(id);
  const meta = JSON.parse(agent.metadata);
  console.log(`- ${meta.name} (${id})`);
}</code></pre>
            
            <h2>Access Control</h2>
            
            <p>AgentRegistry implements strict access control:</p>
            
            <ul>
                <li><strong>Public Functions:</strong> registerAgent, getAgent, getAgentsByOwner</li>
                <li><strong>Owner-Only:</strong> updateMetadata, deactivateAgent, reactivateAgent</li>
                <li><strong>Contract-Only:</strong> updateReputation (called by DACRegistry)</li>
            </ul>
            
            <pre><code>modifier onlyAgentOwner(bytes32 agentId) {
    require(agents[agentId].owner == msg.sender, "Not agent owner");
    _;
}

modifier onlyDACRegistry() {
    require(msg.sender == dacRegistryAddress, "Only DAC Registry");
    _;
}</code></pre>
            
            <h2>Storage Gas Optimization</h2>
            
            <p>AgentRegistry uses optimized storage patterns:</p>
            
            <ul>
                <li><strong>Packed Structs:</strong> Variables ordered by size to minimize storage slots</li>
                <li><strong>bytes32 Keys:</strong> Efficient mapping keys instead of strings</li>
                <li><strong>Indexed Events:</strong> Faster event filtering with indexed parameters</li>
                <li><strong>View Functions:</strong> No gas cost for read-only operations</li>
            </ul>
            
            <div class="cards-grid">
                <div class="card">
                    <div class="icon">üíæ</div>
                    <h3>Efficient Storage</h3>
                    <p>Packed structs<br>
                    Optimized mappings<br>
                    Minimal SSTORE calls</p>
                </div>
                
                <div class="card">
                    <div class="icon">‚ö°</div>
                    <h3>Gas Optimized</h3>
                    <p>~100k registration<br>
                    ~50k updates<br>
                    Free queries</p>
                </div>
                
                <div class="card">
                    <div class="icon">üîê</div>
                    <h3>Secure</h3>
                    <p>Owner validation<br>
                    Reentrancy protected<br>
                    Input sanitization</p>
                </div>
                
                <div class="card">
                    <div class="icon">üìä</div>
                    <h3>Observable</h3>
                    <p>Comprehensive events<br>
                    Indexed parameters<br>
                    Full audit trail</p>
                </div>
            </div>
            
            <div class="info-box success">
                <h4>‚úÖ Battle-Tested</h4>
                <p>AgentRegistry has been audited and is handling production traffic. It implements best practices from OpenZeppelin and has comprehensive test coverage.</p>
            </div>
            
            <h2>Related Documentation</h2>
            
            <ul>
                <li><a href="identity.html">Identity System</a> - How agent identities work</li>
                <li><a href="dac-registry.html">DACRegistry</a> - Attestations and access control</li>
                <li><a href="contracts-overview.html">Contract Overview</a> - All protocol contracts</li>
            </ul>
        </div>
    </main>
</body>
</html>